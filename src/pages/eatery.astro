---
import { getEatery } from '@api/eatery/getEatery';
import LinkSns from '@components/ui/LinkSns.astro';
import PageTitle from '@components/ui/PageTitle.astro';
import Layout from '@layouts/Layout.astro';
import type { TEatery } from '@libs/types';

const response = await getEatery({});
const contents = response.contents;

const snsLink = (item: TEatery, platform: 'Instagram' | 'Twitter') => {
	const platformLowerCase: 'instagram' | 'twitter' = platform.toLowerCase() as
		| 'instagram'
		| 'twitter';
	const platformUrl = item[`${platformLowerCase}Url`];
	const platformName = item[`${platformLowerCase}Name`];
	return { platformUrl, platformName };
};

const logoSize = (
	title: string
): { mobileWidth: string; desktopWidth: string } | void => {
	if (title.includes('Sui')) {
		return { mobileWidth: '150', desktopWidth: '220' };
	}
	if (title.includes('ひとやすみ')) {
		return { mobileWidth: '75', desktopWidth: '100' };
	}
};
---

<Layout headTitle={'飲食店ご紹介'}>
	<PageTitle titleJa="飲食店のご紹介" titleEn="introduce eateries" />
	{
		contents.map(item => (
			<article class="eatery">
				<div
					class="eatery__logo"
					style={{ width: `${logoSize(item.title)?.mobileWidth}px` }}
				>
					<img src={item.image.url} alt={`logo of ${item.title}`} loading="lazy" />
				</div>
				<h2>{item.title}</h2>
				<div class="eatery__sns">
					{item.sns.map(platform => (
						<LinkSns
							text={
								snsLink(item, platform).platformName !== undefined
									? snsLink(item, platform).platformName
									: platform
							}
							link={
								snsLink(item, platform).platformUrl !== undefined
									? snsLink(item, platform).platformUrl
									: '/'
							}
							image={`${platform}.svg`}
							imageAlt={platform}
						/>
					))}
				</div>
				<div>
					<p class="small-underline">{item.floor}</p>
					<div class="small-underline">
						<p>毎週{item.dayOff}曜日 定休</p>
						<p>{item.businessInfo}</p>
					</div>
				</div>
			</article>
		))
	}
</Layout>

<style lang="scss">
	.eatery__sns {
		margin: 60px 0;
	}
</style>
